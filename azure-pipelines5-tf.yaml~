- task: odluser248927.azure-pipelines-tasks-terraform.azure-piplines-tasks-terraform-installer.TerraformInstaller@0
      displayName: 'Terrafom installation'
      inputs:
        terraformVersion: '1.5.7'
    
    # Run Terraform Init on the pipeline agent 
    # ToDo: Replace the resource group name, storage account name, and container name below
    - task: azure-pipelines-tasks-terraform.azure-piplines-tasks-terraform-cli.TerraformCLI@0
      displayName: 'Terrafom init'
      inputs:
        provider: 'azurerm'
        command: 'init'
        workingDirectory: '$(System.DefaultWorkingDirectory)/terraform/environments/Azuredevops'
        backendServiceArm: '$(azureServiceConnectionId)'
        backendAzureRmResourceGroupName: 'Azuredevops'
        backendAzureRmStorageAccountName: 'mydevopsblob'
        backendAzureRmContainerName: 'tfstate'
        backendAzureRmKey: 'myAzuredevops.terraform.tfstate'

    - task: azure-pipeline-terraform-tasks.custom-terraform-release-task.TerraformTaskV1@0
      displayName: Terraform plan 
      inputs:
        command: plan
        provider: 'azurerm'
        commandOptions: '-out="out.tfplan"'
        
    - task: azure-pipeline-terraform-tasks.custom-terraform-release-task.TerraformTaskV2@0
      displayName: "Terraform apply"
      inputs:
        command: apply
        provider: 'azurerm'
        commandOptions: 'out.tfplan'
